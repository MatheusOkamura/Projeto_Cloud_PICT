# ğŸ”„ FLUXOGRAMA VISUAL - Login Normal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USUARIO ACESSA /login                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Qual mÃ©todo de login?             â”‚
        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
           â”‚                                â”‚
           â–¼                                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  FormulÃ¡rio  â”‚              â”‚  OAuth Microsoftâ”‚
    â”‚  (Legacy)    â”‚              â”‚  (Recomendado)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                               â”‚
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â”‚
           â–¼ â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Ã‰ usuario de teste? â”‚
    â”‚  (3 especificos)     â”‚
    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚ SIM          â”‚ NAO
       â”‚              â”‚
       â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ TESTE USER  â”‚  â”‚ USUARIO NORMAL         â”‚
    â”‚             â”‚  â”‚                        â”‚
    â”‚ â€¢ Qualquer  â”‚  â”‚ Legacy: BLOQUEADO (403)â”‚
    â”‚   senha     â”‚  â”‚ OAuth: PERMITIDO       â”‚
    â”‚ â€¢ Bypass de â”‚  â”‚                        â”‚
    â”‚   cadastro  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ Direto p/ â”‚              â”‚
    â”‚   dashboard â”‚              â”‚ (via OAuth)
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
           â”‚                     â–¼
           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              â”‚ Microsoft autentica  â”‚
           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚
           â”‚                         â–¼
           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              â”‚ Backend callback     â”‚
           â”‚              â”‚ Busca no banco:      â”‚
           â”‚              â”‚ email == usuario?    â”‚
           â”‚              â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
           â”‚                 â”‚ NAO           â”‚ SIM
           â”‚                 â”‚ EXISTE        â”‚ EXISTE
           â”‚                 â–¼               â–¼
           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚          â”‚ CRIAR NOVO   â”‚  â”‚ ENCONTRADO   â”‚
           â”‚          â”‚ USUARIO      â”‚  â”‚              â”‚
           â”‚          â”‚              â”‚  â”‚ Tem todos os â”‚
           â”‚          â”‚ is_new_user  â”‚  â”‚ dados?       â”‚
           â”‚          â”‚ = TRUE       â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
           â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ NAO    â”‚ SIM
           â”‚                 â”‚             â”‚        â”‚
           â”‚                 â”‚             â–¼        â–¼
           â”‚                 â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                 â”‚      â”‚is_new_   â”‚ â”‚is_new_   â”‚
           â”‚                 â”‚      â”‚user=TRUE â”‚ â”‚user=FALSEâ”‚
           â”‚                 â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚           â”‚            â”‚
           â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â”‚                             â–¼
           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                  â”‚ Redireciona p/      â”‚
           â”‚                  â”‚ Frontend c/ token + â”‚
           â”‚                  â”‚ is_new_user flag    â”‚
           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Frontend (AuthCallback) â”‚
                            â”‚ Verifica is_new_user?   â”‚
                            â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                               â”‚ TRUE              â”‚ FALSE
                               â”‚                   â”‚
                               â–¼                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   /cadastro     â”‚  â”‚  /dashboard- â”‚
                      â”‚                 â”‚  â”‚  {tipo}      â”‚
                      â”‚ Usuario         â”‚  â”‚              â”‚
                      â”‚ preenche:       â”‚  â”‚ Usuario ja   â”‚
                      â”‚                 â”‚  â”‚ esta pronto  â”‚
                      â”‚ â€¢ CPF           â”‚  â”‚ para usar    â”‚
                      â”‚ â€¢ Telefone      â”‚  â”‚ sistema      â”‚
                      â”‚ â€¢ Curso (aluno) â”‚  â”‚              â”‚
                      â”‚ â€¢ Matricula     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ â€¢ Depto (prof)  â”‚
                      â”‚                 â”‚
                      â”‚ Salva no banco  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Proximo login:  â”‚
                      â”‚ Dashboard diretoâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DADOS OBRIGATÃ“RIOS

### Aluno
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CPF         â”‚ â† OBRIGATORIO
â”‚ Telefone    â”‚ â† OBRIGATORIO
â”‚ Curso       â”‚ â† OBRIGATORIO
â”‚ Matricula   â”‚ â† OBRIGATORIO
â”‚ CR          â”‚   opcional
â”‚ Unidade     â”‚   opcional
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Orientador
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Telefone    â”‚ â† OBRIGATORIO
â”‚ Departamentoâ”‚ â† OBRIGATORIO
â”‚ Area Pesq.  â”‚   opcional
â”‚ Titulacao   â”‚   opcional
â”‚ Vagas       â”‚   opcional
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Coordenador
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Telefone    â”‚ â† OBRIGATORIO
â”‚ Departamentoâ”‚ â† OBRIGATORIO
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ CENÃRIOS DE USO

### CenÃ¡rio 1: Desenvolvimento - Usuario de Teste
```
aluno.teste@alunos.ibmec.edu.br
        â†“
    FormulÃ¡rio (qualquer senha)
        â†“
    is_test_user() = TRUE
        â†“
    Bypass verificaÃ§Ã£o
        â†“
    is_new_user = FALSE
        â†“
    /dashboard-aluno
```

### CenÃ¡rio 2: Usuario Novo (OAuth)
```
maria.silva@alunos.ibmec.edu.br
        â†“
    OAuth Microsoft
        â†“
    Autentica com sucesso
        â†“
    Backend: usuario nÃ£o existe
        â†“
    Cria usuario (email, nome, tipo=aluno)
        â†“
    Verifica dados: cpf=null, telefone=null, curso=null, matricula=null
        â†“
    is_new_user = TRUE
        â†“
    /cadastro (preenche dados)
        â†“
    Salva no banco
        â†“
    Proximo login: /dashboard-aluno
```

### CenÃ¡rio 3: Usuario Existente com Dados Incompletos
```
joao.silva@alunos.ibmec.edu.br
        â†“
    OAuth Microsoft
        â†“
    Backend: usuario existe
        â†“
    Verifica dados: cpf=OK, telefone=null âŒ, curso=OK, matricula=OK
        â†“
    Falta telefone!
        â†“
    is_new_user = TRUE
        â†“
    /cadastro (preenche telefone)
        â†“
    Proximo login: /dashboard-aluno
```

### CenÃ¡rio 4: Usuario Existente Completo
```
carlos.santos@alunos.ibmec.edu.br
        â†“
    OAuth Microsoft
        â†“
    Backend: usuario existe
        â†“
    Verifica dados: cpf=OK âœ…, telefone=OK âœ…, curso=OK âœ…, matricula=OK âœ…
        â†“
    Tudo preenchido!
        â†“
    is_new_user = FALSE
        â†“
    /dashboard-aluno (direto)
```

---

## ğŸ”„ MATRIZ DE DECISÃƒO

| Existe no DB? | Dados Completos? | Ã‰ Teste? | is_new_user | Destino |
|--------------|------------------|----------|-------------|---------|
| âŒ NÃ£o       | N/A              | âŒ NÃ£o   | âœ… TRUE     | ğŸ“ Cadastro |
| âœ… Sim       | âŒ NÃ£o           | âŒ NÃ£o   | âœ… TRUE     | ğŸ“ Cadastro |
| âœ… Sim       | âœ… Sim           | âŒ NÃ£o   | âŒ FALSE    | ğŸ“Š Dashboard |
| âœ… Sim       | âŒ NÃ£o           | âœ… Sim   | âŒ FALSE    | ğŸ“Š Dashboard |
| âœ… Sim       | âœ… Sim           | âœ… Sim   | âŒ FALSE    | ğŸ“Š Dashboard |

**Regra de Ouro:** UsuÃ¡rios de teste SEMPRE vÃ£o direto pro dashboard.

---

## ğŸ§ª COMANDOS DE TESTE

```powershell
# Teste completo do fluxo
.\test_fluxo_normal_login.ps1

# Simulacao OAuth
.\test_simulacao_oauth_novo_usuario.ps1

# Ver logs do backend
# (enquanto backend esta rodando)
# Busque por: âš ï¸ precisa completar cadastro
```

---

## ğŸ“± INTERFACE DO USUARIO

### Tela de Login
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Login                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  [ğŸªŸ Entrar com Microsoft]      â”‚
â”‚     â† RECOMENDADO               â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€ Ou use o formulÃ¡rio â”€â”€â”€â”€â”‚
â”‚                                 â”‚
â”‚  Email: [________________]      â”‚
â”‚  Senha: [________________]      â”‚
â”‚                                 â”‚
â”‚  [Entrar]                       â”‚
â”‚                                 â”‚
â”‚  ğŸ’¡ Para demonstraÃ§Ã£o:          â”‚
â”‚  aluno.teste@alunos.ibmec.edu.brâ”‚
â”‚  Senha: qualquer (ex: 123)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela de Cadastro (quando is_new_user=true)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Complete seu Cadastro       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Email: maria.silva@alunos...   â”‚
â”‚  Nome: Maria Silva              â”‚
â”‚                                 â”‚
â”‚  CPF: [___.___.___-__] *        â”‚
â”‚  Telefone: [(__) _____-____] *  â”‚
â”‚  Curso: [â–¼ Selecione] *         â”‚
â”‚  MatrÃ­cula: [__________] *      â”‚
â”‚                                 â”‚
â”‚  [Salvar e Continuar]           â”‚
â”‚                                 â”‚
â”‚  * Campos obrigatÃ³rios          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**VersÃ£o:** 2.0  
**Data:** 21/11/2024  
**Status:** âœ… Implementado e Testado
